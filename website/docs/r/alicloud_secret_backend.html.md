---
layout: "vault"
page_title: "Vault: vault_alicloud_secret_backend resource"
sidebar_current: "docs-vault-resource-alicloud-secret-backend"
description: |-
  Manages the AliCloud secrets engine in Vault
---

# vault\_alicloud\_secret\_backend

Manages the AliCloud secrets engine in Vault. The AliCloud secrets engine dynamically generates AliCloud 
access credentials based on RAM policies. This allows Vault users to gain access to AliCloud resources 
without needing to create or manage AliCloud credentials manually.

~> **Important** All data provided in the resource configuration will be
written in cleartext to state and plan files generated by Terraform, and
will appear in the console output when Terraform runs. Protect these
artifacts accordingly. See
[the main provider documentation](../index.html)
for more details.

## Example Usage

### Basic Configuration

```hcl
resource "vault_alicloud_secret_backend" "alicloud" {
  path                  = "alicloud"
  access_key            = var.alicloud_access_key
  secret_key_wo         = var.alicloud_secret_key
  secret_key_wo_version = 1
}

variable "alicloud_access_key" {
  description = "AliCloud Access Key ID"
  type        = string
  sensitive   = true
}

variable "alicloud_secret_key" {
  description = "AliCloud Secret Access Key"
  type        = string
  sensitive   = true
}
```

### Credential Rotation Using Write-Only Pattern

```hcl
# Initial configuration
resource "vault_alicloud_secret_backend" "alicloud" {
  path                  = "alicloud"
  access_key            = var.alicloud_access_key
  secret_key_wo         = var.alicloud_secret_key
  secret_key_wo_version = 1
}

# To rotate credentials, update both secret_key_wo and increment the version
resource "vault_alicloud_secret_backend" "alicloud_rotated" {
  path                  = "alicloud"
  access_key            = var.alicloud_access_key_new
  secret_key_wo         = var.alicloud_secret_key_new
  secret_key_wo_version = 2  # Increment to trigger update
}
```

## Argument Reference

The following arguments are supported:

* `path` - (Required) Path where the AliCloud secrets engine will be mounted. This path cannot be changed after creation.

* `access_key` - (Required, Sensitive) The AliCloud Access Key ID with permissions to manage RAM users and policies.
  This credential is used by Vault to create and manage dynamic AliCloud credentials.

* `secret_key_wo_version` - (Required) Version number for the write-only secret key. Increment this value to force 
  credential rotation. When this value changes, Terraform will send the updated `secret_key_wo` to Vault.

## Ephemeral Attributes Reference

The following write-only attributes are supported:

* `secret_key_wo` - (Required, Sensitive) Write-only AliCloud Secret Access Key corresponding to the `access_key`. 
  Use this when you want to prevent the secret key from being stored in Terraform state.
  **Note**: This property is write-only and will not be read from the API. To update this value, you must also 
  increment `secret_key_wo_version`.

## Attributes Reference

In addition to the arguments above, the following attributes are exported:

* `id` - The path where the AliCloud secrets engine is mounted.

## Understanding the Write-Only Pattern

The `secret_key_wo` field uses a write-only pattern to enhance security:

1. **Write-Only**: The secret key is sent to Vault but never read back or stored in Terraform state
2. **Version Trigger**: The `secret_key_wo_version` field acts as a trigger to force updates
3. **Credential Rotation**: To rotate credentials:
   - Update `secret_key_wo` to the new value
   - Increment `secret_key_wo_version` (e.g., from 1 to 2)
   - Run `terraform apply`

### Why Version is Required

Since `secret_key_wo` is write-only, Terraform cannot detect when it changes by comparing state. 
The version field solves this by providing a detectable change that triggers the update.


## Import

AliCloud secrets engines can be imported using the `path`, e.g.

```
$ terraform import vault_alicloud_secret_backend.alicloud alicloud
```

~> **Note:** When importing, the `secret_key_wo` field will not be populated as it is 
write-only and not returned by the Vault API. You will need to provide this value in your 
configuration after import.

## Required AliCloud Permissions

The Access Key provided must have the following RAM permissions:

### Minimum Required Permissions

- `ram:CreateUser` - Create RAM users for dynamic credentials
- `ram:DeleteUser` - Delete RAM users when credentials expire
- `ram:AttachPolicyToUser` - Attach policies to created users
- `ram:DetachPolicyFromUser` - Detach policies from users
- `ram:CreateAccessKey` - Create access keys for users
- `ram:DeleteAccessKey` - Delete access keys
- `ram:GetUser` - Read user information
- `ram:ListAccessKeys` - List access keys for users

### Recommended Policy

```json
{
  "Version": "1",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ram:CreateUser",
        "ram:DeleteUser",
        "ram:AttachPolicyToUser",
        "ram:DetachPolicyFromUser",
        "ram:CreateAccessKey",
        "ram:DeleteAccessKey",
        "ram:GetUser",
        "ram:ListAccessKeys"
      ],
      "Resource": "*"
    }
  ]
}
```

## References

- [AliCloud Secrets Engine API Documentation](https://developer.hashicorp.com/vault/api-docs/secret/alicloud)
- [AliCloud RAM Documentation](https://www.alibabacloud.com/help/en/ram)