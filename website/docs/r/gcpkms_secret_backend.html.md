---
layout: "vault"
page_title: "Vault: vault_gcpkms_secret_backend resource"
sidebar_current: "docs-vault-resource-gcpkms-secret-backend"
description: |-
  Manages the GCP KMS secrets engine in Vault
---

# vault\_gcpkms\_secret\_backend

Manages the GCP KMS secrets engine in Vault. The GCP KMS secrets engine provides encryption and decryption 
services backed by Google Cloud Platform's Key Management Service (KMS). This allows you to use GCP KMS keys 
for cryptographic operations through Vault.

~> **Important** All data provided in the resource configuration will be
written in cleartext to state and plan files generated by Terraform, and
will appear in the console output when Terraform runs. Protect these
artifacts accordingly. See
[the main provider documentation](../index.html.markdown)
for more details.

## Example Usage

### Basic Configuration

```hcl
resource "vault_gcpkms_secret_backend" "gcpkms" {
  path        = "gcpkms"
  credentials = file("gcp-credentials.json")
}
```

### With Custom Scopes

```hcl
resource "vault_gcpkms_secret_backend" "gcpkms" {
  path        = "gcpkms"
  credentials = file("gcp-credentials.json")
  scopes = [
    "https://www.googleapis.com/auth/cloudkms",
    "https://www.googleapis.com/auth/cloud-platform"
  ]
}
```

### Using Write-Only Credentials

```hcl
resource "vault_gcpkms_secret_backend" "gcpkms" {
  path                     = "gcpkms"
  credentials_wo           = file("gcp-credentials.json")
  credentials_wo_version   = 1
}

# To rotate credentials, increment the version
resource "vault_gcpkms_secret_backend" "gcpkms_rotated" {
  path                     = "gcpkms"
  credentials_wo           = file("gcp-credentials-new.json")
  credentials_wo_version   = 2
}
```

## Argument Reference

The following arguments are supported:

* `namespace` - (Optional) The namespace of the target resource.
  The value should not contain leading or trailing forward slashes.
  The `namespace` is always relative to the provider's
  configured [namespace](/docs/providers/vault/index.html#namespace).
  *Available only for Vault Enterprise*.

* `path` - (Required) Path where the GCP KMS secrets engine will be mounted. This path cannot be changed after creation.

* `credentials` - (Optional, Sensitive) JSON-encoded GCP service account credentials with permissions to access Cloud KMS. 
  Cannot be used with `credentials_wo`. The credentials should have the `cloudkms.cryptoKeyVersions.useToEncrypt`, 
  `cloudkms.cryptoKeyVersions.useToDecrypt`, and `cloudkms.cryptoKeys.get` permissions at minimum.

* `credentials_wo_version` - (Optional) Version number for the write-only credentials. Increment this value to force 
  credential rotation. Only valid when using `credentials_wo`.

* `scopes` - (Optional) List of OAuth scopes to use for GCP API requests. Defaults to `["https://www.googleapis.com/auth/cloudkms"]`.
  Common scopes include:
  - `https://www.googleapis.com/auth/cloudkms` - Cloud KMS access
  - `https://www.googleapis.com/auth/cloud-platform` - Full cloud platform access

## Ephemeral Attributes Reference

The following write-only attributes are supported:

* `credentials_wo` - (Optional, Sensitive) Write-only JSON-encoded GCP service account credentials. Cannot be used with `credentials`. 
  Use this when you want to prevent credentials from being stored in Terraform state.
  **Note**: This property is write-only and will not be read from the API.

## Attributes Reference

In addition to the arguments above, the following attributes are exported:

* `id` - The path where the GCP KMS secrets engine is mounted.

## Import

GCP KMS secrets engines can be imported using the `path`, e.g.

```
$ terraform import vault_gcpkms_secret_backend.gcpkms gcpkms
```

~> **Note:** When importing, the `credentials` and `credentials_wo` fields will not be populated as they are 
write-only and not returned by the Vault API.

## Required GCP Permissions

The service account credentials provided must have the following IAM permissions:

- `cloudkms.cryptoKeyVersions.useToEncrypt` - For encryption operations
- `cloudkms.cryptoKeyVersions.useToDecrypt` - For decryption operations  
- `cloudkms.cryptoKeyVersions.useToSign` - For signing operations
- `cloudkms.cryptoKeyVersions.get` - For reading key version information
- `cloudkms.cryptoKeys.get` - For reading key information
- `cloudkms.cryptoKeys.create` - For creating new keys (optional)

These permissions are typically granted through the `Cloud KMS CryptoKey Encrypter/Decrypter` and 
`Cloud KMS Viewer` IAM roles.
