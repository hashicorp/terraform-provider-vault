---
layout: "vault"
page_title: "Vault: vault_keymgmt_gcp_kms resource"

description: |-
  Manages GCP Cloud KMS provider in the Vault Key Management secrets engine
---

# vault\_keymgmt\_gcp\_kms

Manages a GCP Cloud KMS provider in the Vault Key Management secrets engine. This resource configures Vault to integrate with Google Cloud Platform's Key Management Service, allowing keys created in Vault to be distributed to GCP Cloud KMS for use in GCP services.

Once configured, keys can be distributed to GCP Cloud KMS using the `vault_keymgmt_distribute_key` resource.

~> **Important** All data provided in the resource configuration will be
written in cleartext to state and plan files generated by Terraform, and
will appear in the console output when Terraform runs. Protect these
artifacts accordingly. See
[the main provider documentation](../index.html)
for more details.

**Note** this feature is available only with Vault Enterprise.

## Example Usage

### Basic Configuration

```hcl
resource "vault_mount" "keymgmt" {
  path = "keymgmt"
  type = "keymgmt"
}

resource "vault_keymgmt_gcp_kms" "production" {
  path           = vault_mount.keymgmt.path
  name           = "gcp-production"
  key_collection = "projects/my-project/locations/us-central1/keyRings/my-keyring"
  credentials    = file("gcp-credentials.json")
}
```

### Using Credentials from Variable

```hcl
variable "gcp_credentials" {
  type      = string
  sensitive = true
}

resource "vault_keymgmt_gcp_kms" "gcp" {
  path           = vault_mount.keymgmt.path
  name           = "gcp-kms"
  key_collection = "projects/${var.gcp_project}/locations/${var.gcp_location}/keyRings/${var.gcp_keyring}"
  credentials    = var.gcp_credentials
}
```

### Complete Example with Key Distribution

```hcl
resource "vault_keymgmt_gcp_kms" "gcp" {
  path           = vault_mount.keymgmt.path
  name           = "gcp-cloud-kms"
  key_collection = "projects/my-project/locations/us-central1/keyRings/vault-keyring"
  credentials    = file("service-account.json")
}

resource "vault_keymgmt_key" "encryption_key" {
  path = vault_mount.keymgmt.path
  name = "gcp-encryption-key"
  type = "aes256-gcm96"
}

resource "vault_keymgmt_distribute_key" "gcp_dist" {
  path     = vault_mount.keymgmt.path
  kms_name = vault_keymgmt_gcp_kms.gcp.name
  key_name = vault_keymgmt_key.encryption_key.name
  purpose  = ["encrypt", "decrypt"]
}
```

## Argument Reference

The following arguments are supported:

* `namespace` - (Optional) The namespace of the target resource.
  The value should not contain leading or trailing forward slashes.
  The `namespace` is always relative to the provider's configured
  [namespace](/docs/providers/vault/index.html#namespace).
  *Available only for Vault Enterprise*.

* `path` - (Required) Path where the Key Management secrets engine is mounted.

* `name` - (Required) Unique name for this GCP Cloud KMS provider. This cannot be changed after creation.

* `key_collection` - (Required) Full resource name of the GCP KMS key ring where keys will be created. Format: `projects/{project}/locations/{location}/keyRings/{keyring}`

* `credentials` - (Required, Sensitive) JSON-encoded GCP service account credentials with permissions to manage Cloud KMS keys.

## Attributes Reference

In addition to the arguments above, the following attributes are exported:

* `id` - The unique identifier for the GCP Cloud KMS provider. Format: `{path}/kms/{name}`

## Import

GCP Cloud KMS providers can be imported using the format `{path}/kms/{name}`, e.g.

```
$ terraform import vault_keymgmt_gcp_kms.production keymgmt/kms/gcp-production
```

~> **Note:** When importing, the `credentials` field will not be populated as it is write-only and not returned by the Vault API.

## Required GCP Permissions

The service account credentials provided must have the following IAM permissions on the specified key ring:

### Cloud KMS Permissions

- `cloudkms.cryptoKeys.create` - To create new crypto keys
- `cloudkms.cryptoKeys.get` - To read key information
- `cloudkms.cryptoKeys.list` - To list keys
- `cloudkms.cryptoKeys.update` - To update key properties
- `cloudkms.cryptoKeyVersions.create` - To create key versions
- `cloudkms.cryptoKeyVersions.destroy` - To destroy key versions (when deletion_allowed is true)
- `cloudkms.cryptoKeyVersions.get` - To read key version information
- `cloudkms.cryptoKeyVersions.list` - To list key versions
- `cloudkms.cryptoKeyVersions.useToEncrypt` - For encryption operations
- `cloudkms.cryptoKeyVersions.useToDecrypt` - For decryption operations
- `cloudkms.cryptoKeyVersions.useToSign` - For signing operations

### Recommended IAM Roles

The following predefined IAM roles provide the necessary permissions:

- **Cloud KMS Admin** (`roles/cloudkms.admin`) - Full access to Cloud KMS resources (recommended for initial setup)
- **Cloud KMS CryptoKey Encrypter/Decrypter** (`roles/cloudkms.cryptoKeyEncrypterDecrypter`) - For encryption/decryption operations
- **Cloud KMS Viewer** (`roles/cloudkms.viewer`) - For read-only operations

### Example: Creating a Service Account with Required Permissions

```bash
# Create a service account
gcloud iam service-accounts create vault-keymgmt \
  --display-name="Vault Key Management"

# Grant Cloud KMS Admin role to the service account
gcloud projects add-iam-policy-binding my-project \
  --member="serviceAccount:vault-keymgmt@my-project.iam.gserviceaccount.com" \
  --role="roles/cloudkms.admin"

# Create and download service account key
gcloud iam service-accounts keys create vault-keymgmt-key.json \
  --iam-account=vault-keymgmt@my-project.iam.gserviceaccount.com
```

### Example: Granting Permissions at Key Ring Level

For better security, grant permissions only at the key ring level:

```bash
gcloud kms keyrings add-iam-policy-binding my-keyring \
  --location=us-central1 \
  --member="serviceAccount:vault-keymgmt@my-project.iam.gserviceaccount.com" \
  --role="roles/cloudkms.admin"
```

## GCP Key Ring Configuration

Before using this resource, you must create a Cloud KMS key ring in your GCP project:

```bash
# Create a key ring
gcloud kms keyrings create my-keyring \
  --location=us-central1 \
  --project=my-project
```

The key ring location determines where cryptographic operations will be performed. Choose a location close to your application for better performance.

## Supported Locations

GCP Cloud KMS supports both regional and multi-regional locations:

### Regional Locations
- `us-central1`, `us-east1`, `us-west1`, etc.
- `europe-west1`, `europe-west2`, `europe-west3`, etc.
- `asia-east1`, `asia-southeast1`, `asia-northeast1`, etc.

### Multi-Regional Locations
- `us` - Multi-region in the United States
- `eu` - Multi-region in Europe
- `asia` - Multi-region in Asia

Multi-regional locations provide higher availability and are suitable for applications that require geographic redundancy.

## Key Distribution

After configuring the GCP Cloud KMS provider, use the `vault_keymgmt_distribute_key` resource to distribute Vault keys to GCP Cloud KMS. The distributed keys can then be used by GCP services for encryption, decryption, signing, and verification operations.
