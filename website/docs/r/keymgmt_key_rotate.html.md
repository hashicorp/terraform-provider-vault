---
layout: "vault"
page_title: "Vault: vault_keymgmt_key_rotate resource"

description: |-
  Rotates keys in the Vault Key Management secrets engine
---

# vault\_keymgmt\_key\_rotate

Rotates a key in the Vault Key Management secrets engine. This resource creates a new version of an existing key, which is useful for implementing key rotation policies and maintaining security best practices.

Key rotation creates a new cryptographic key version while keeping the old versions available for decryption of data encrypted with previous versions.

~> **Important** All data provided in the resource configuration will be
written in cleartext to state and plan files generated by Terraform, and
will appear in the console output when Terraform runs. Protect these
artifacts accordingly. See
[the main provider documentation](../index.html)
for more details.

**Note** this feature is available only with Vault Enterprise.

## Example Usage

### Basic Key Rotation

```hcl
resource "vault_mount" "keymgmt" {
  path = "keymgmt"
  type = "keymgmt"
}

resource "vault_keymgmt_key" "encryption_key" {
  path = vault_mount.keymgmt.path
  name = "rotation-example"
  type = "aes256-gcm96"
}

resource "vault_keymgmt_key_rotate" "rotate" {
  path = vault_mount.keymgmt.path
  name = vault_keymgmt_key.encryption_key.name
}
```

### Scheduled Rotation Using Terraform

You can use Terraform to implement scheduled rotation by using a timestamp-based approach:

```hcl
# Rotate the key monthly
resource "vault_keymgmt_key_rotate" "monthly_rotation" {
  path = vault_mount.keymgmt.path
  name = vault_keymgmt_key.encryption_key.name
  
  # This will trigger rotation when the month changes
  # Use terraform apply regularly (e.g., via automation)
}
```

### Rotation with External Trigger

```hcl
# Use a null_resource with a trigger to force rotation
resource "null_resource" "rotation_trigger" {
  triggers = {
    rotation_timestamp = var.force_rotation_timestamp
  }
}

resource "vault_keymgmt_key_rotate" "triggered_rotation" {
  path = vault_mount.keymgmt.path
  name = vault_keymgmt_key.encryption_key.name
  
  # This creates a dependency that will cause rotation when the trigger changes
  depends_on = [null_resource.rotation_trigger]
}
```

## Argument Reference

The following arguments are supported:

* `namespace` - (Optional) The namespace of the target resource.
  The value should not contain leading or trailing forward slashes.
  The `namespace` is always relative to the provider's configured
  [namespace](/docs/providers/vault/index.html#namespace).
  *Available only for Vault Enterprise*.

* `path` - (Required) Path where the Key Management secrets engine is mounted.

* `name` - (Required) Name of the key to rotate (created via `vault_keymgmt_key`).

## Attributes Reference

In addition to the arguments above, the following attributes are exported:

* `id` - The unique identifier for the key rotation operation. Format: `{path}/key/{name}/rotate`

* `latest_version` - The latest version number of the key after rotation.

## Import

Key rotation resources can be imported using the format `{path}/key/{name}/rotate`, e.g.

```
$ terraform import vault_keymgmt_key_rotate.rotate keymgmt/key/rotation-example/rotate
```

## Key Rotation Behavior

### What Happens During Rotation

When a key is rotated:

1. A new cryptographic key version is created
2. The `latest_version` counter is incremented
3. New encryption operations use the new version
4. Previous versions remain available for decryption
5. Distributed keys in external KMS systems are updated with the new version

### Key Version Management

After rotation:
- **Latest Version**: The most recent version created by rotation
- **Min Enabled Version**: The minimum version that can be used for operations
- **Old Versions**: Previous versions remain available for decryption but not for encryption

### Terraform State Considerations

The `vault_keymgmt_key_rotate` resource triggers a rotation every time it is created or updated. This means:

- `terraform apply` will rotate the key
- Recreating the resource will cause another rotation
- Importing the resource does not trigger rotation

For automated rotation, consider using:
- Terraform Cloud/Enterprise scheduled runs
- External automation (CI/CD pipelines, cron jobs)
- Vault's native key rotation policies (if available)

## Rotation Best Practices

### Frequency

- **High Security Requirements**: Rotate monthly or quarterly
- **Standard Security**: Rotate annually
- **Compliance-Driven**: Follow your industry's compliance requirements (e.g., PCI-DSS, HIPAA)

### Distributed Keys

When rotating keys that have been distributed to external KMS providers:

1. The rotation is propagated to the external KMS
2. New cryptographic operations use the new version
3. Old versions remain available for decryption
4. Monitor the external KMS to ensure the rotation completed successfully

### Managing Old Versions

- Keep old versions for a grace period to allow decryption of existing data
- After the grace period, consider using `min_enabled_version` to disable old versions
- Never delete versions that may be needed for decryption

## Use Cases

### Compliance Requirements

Many compliance frameworks require regular key rotation:
- **PCI-DSS**: Cryptographic keys must be rotated periodically
- **HIPAA**: Encryption keys should be rotated as part of security best practices
- **SOC 2**: Key rotation is often required for Type II certification

### Security Incident Response

Rotate keys immediately after:
- Suspected key compromise
- Employee termination (for keys they had access to)
- Security audits that recommend rotation
- Breach notifications

### Lifecycle Management

Rotate keys as part of normal lifecycle management:
- Application version updates
- Infrastructure migrations
- Periodic security maintenance

## Automation Examples

### Using Terraform Cloud

```hcl
# Configure Terraform Cloud to run on a schedule
terraform {
  cloud {
    organization = "my-org"
    workspaces {
      name = "key-rotation"
    }
  }
}

resource "vault_keymgmt_key_rotate" "scheduled" {
  path = vault_mount.keymgmt.path
  name = "auto-rotated-key"
}
```

### Using CI/CD Pipeline

```yaml
# GitLab CI example
key_rotation:
  stage: security
  script:
    - terraform init
    - terraform apply -auto-approve -target=vault_keymgmt_key_rotate.rotate
  only:
    - schedules  # Run on pipeline schedules
```

## Monitoring and Validation

After rotation, verify:

1. The `latest_version` has incremented
2. External KMS providers show the new version
3. Applications can still decrypt existing data
4. New encryptions use the new version
5. No errors in Vault audit logs
