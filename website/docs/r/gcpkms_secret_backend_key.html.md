---
layout: "vault"
page_title: "Vault: vault_gcpkms_secret_backend_key resource"
sidebar_current: "docs-vault-resource-gcpkms-secret-backend-key"
description: |-
  Manages keys in the GCP KMS secrets engine
---

# vault\_gcpkms\_secret\_backend\_key

Manages keys in the GCP KMS secrets engine. This resource creates new GCP KMS keys in Google Cloud and 
registers them with Vault for use in cryptographic operations.

Keys can be used for encryption, decryption, signing, and verification operations through Vault, with the actual 
cryptographic operations delegated to Google Cloud KMS.

~> **Important** All data provided in the resource configuration will be
written in cleartext to state and plan files generated by Terraform, and
will appear in the console output when Terraform runs. Protect these
artifacts accordingly. See
[the main provider documentation](../index.html.markdown)
for more details.

## Example Usage

### Creating a New Encryption Key

```hcl
resource "vault_gcpkms_secret_backend" "gcpkms" {
  path        = "gcpkms"
  credentials = file("gcp-credentials.json")
}

resource "vault_gcpkms_secret_backend_key" "encryption_key" {
  backend          = vault_gcpkms_secret_backend.gcpkms.path
  name             = "my-encryption-key"
  key_ring         = "projects/my-project/locations/us-central1/keyRings/my-keyring"
  purpose          = "ENCRYPT_DECRYPT"
  algorithm        = "GOOGLE_SYMMETRIC_ENCRYPTION"
  protection_level = "SOFTWARE"
  rotation_period  = "2592000s"  # 30 days
  
  labels = {
    env        = "production"
    managed_by = "terraform"
  }
}
```

### Creating a Signing Key

```hcl
resource "vault_gcpkms_secret_backend_key" "signing_key" {
  backend   = vault_gcpkms_secret_backend.gcpkms.path
  name      = "my-signing-key"
  key_ring  = "projects/my-project/locations/us-central1/keyRings/my-keyring"
  purpose   = "ASYMMETRIC_SIGN"
  algorithm = "RSA_SIGN_PSS_2048_SHA256"
}
```

### Using a Custom Crypto Key Name

By default, the crypto key in GCP KMS will have the same name as the Vault key. You can override this using the `crypto_key` parameter:

```hcl
resource "vault_gcpkms_secret_backend_key" "custom_name" {
  backend    = vault_gcpkms_secret_backend.gcpkms.path
  name       = "vault-key-name"
  key_ring   = "projects/my-project/locations/us-central1/keyRings/my-keyring"
  crypto_key = "different-gcp-key-name"  # Optional: Use a different name in GCP KMS
  purpose    = "ENCRYPT_DECRYPT"
  algorithm  = "GOOGLE_SYMMETRIC_ENCRYPTION"
}
```

### With HSM Protection

```hcl
resource "vault_gcpkms_secret_backend_key" "hsm_key" {
  backend          = vault_gcpkms_secret_backend.gcpkms.path
  name             = "hsm-protected-key"
  key_ring         = "projects/my-project/locations/us-central1/keyRings/hsm-keyring"
  purpose          = "ENCRYPT_DECRYPT"
  algorithm        = "GOOGLE_SYMMETRIC_ENCRYPTION"
  protection_level = "HSM"
}
```

## Argument Reference

The following arguments are supported:

* `namespace` - (Optional) The namespace of the target resource.
  The value should not contain leading or trailing forward slashes.
  The `namespace` is always relative to the provider's
  configured [namespace](/docs/providers/vault/index.html#namespace).
  *Available only for Vault Enterprise*.

* `backend` - (Required) Path where the GCP KMS secrets engine is mounted.

* `name` - (Required) Name of the key in Vault. This is the name used to reference the key for 
  cryptographic operations.

### Creating New Keys

When creating a new GCP KMS key, the following field is required:

* `key_ring` - (Required) Full resource name of the GCP KMS key ring where the key will be created.
  Format: `projects/{project}/locations/{location}/keyRings/{keyring}`

* `crypto_key` - (Optional) Name of the crypto key to use in GCP KMS. If not specified, defaults to the Vault 
  key name. If the crypto key does not exist in GCP, Vault will create it. If it exists, Vault will use it.

* `purpose` - (Optional) The purpose of the key. Valid values are:
  - `ENCRYPT_DECRYPT` - For encryption and decryption operations (default)
  - `ASYMMETRIC_SIGN` - For signing and verification operations
  - `ASYMMETRIC_DECRYPT` - For asymmetric decryption operations

* `algorithm` - (Optional) The algorithm to use for the key. Defaults to `GOOGLE_SYMMETRIC_ENCRYPTION` for 
  `ENCRYPT_DECRYPT` purpose. Valid values depend on the purpose:
  
  For `ENCRYPT_DECRYPT`:
  - `GOOGLE_SYMMETRIC_ENCRYPTION` (default)
  
  For `ASYMMETRIC_SIGN`:
  - `RSA_SIGN_PSS_2048_SHA256`
  - `RSA_SIGN_PSS_3072_SHA256`
  - `RSA_SIGN_PSS_4096_SHA256`
  - `RSA_SIGN_PKCS1_2048_SHA256`
  - `RSA_SIGN_PKCS1_3072_SHA256`
  - `RSA_SIGN_PKCS1_4096_SHA256`
  - `EC_SIGN_P256_SHA256`
  - `EC_SIGN_P384_SHA384`
  
  For `ASYMMETRIC_DECRYPT`:
  - `RSA_DECRYPT_OAEP_2048_SHA256`
  - `RSA_DECRYPT_OAEP_3072_SHA256`
  - `RSA_DECRYPT_OAEP_4096_SHA256`

* `protection_level` - (Optional) The protection level for the key. Valid values:
  - `SOFTWARE` - Software-protected key (default)
  - `HSM` - Hardware Security Module protected key

* `rotation_period` - (Optional) Rotation period for the key in seconds. Must be at least 1 day (86400s).
  Example: `"2592000s"` for 30 days.

* `labels` - (Optional) Map of labels to apply to the GCP KMS key.

## Attributes Reference

In addition to the arguments above, the following attributes are exported:

* `id` - The unique identifier for the key resource in Vault. Format: `{backend}/keys/{name}`

* `latest_version` - The latest version number of the GCP KMS key.

* `primary_version` - The primary version number of the GCP KMS key that will be used for new cryptographic operations.

## Import

GCP KMS keys can be imported using the format `{backend}/keys/{name}`, e.g.

```
$ terraform import vault_gcpkms_secret_backend_key.encryption_key gcpkms/keys/my-encryption-key
```

## Key Purposes and Algorithms

### Encryption Keys (`ENCRYPT_DECRYPT`)

Used for symmetric encryption and decryption operations. These keys use the `GOOGLE_SYMMETRIC_ENCRYPTION` algorithm
and can be used with the `vault_gcpkms_encrypt` and `vault_gcpkms_decrypt` ephemeral resources.

### Signing Keys (`ASYMMETRIC_SIGN`)

Used for digital signatures and verification. These keys can use various RSA or elliptic curve algorithms
and can be used with the `vault_gcpkms_sign` ephemeral resource and `vault_gcpkms_verify` data source.

### Asymmetric Decryption Keys (`ASYMMETRIC_DECRYPT`)

Used for asymmetric encryption where data is encrypted with the public key and decrypted with the private key.

## Version Management

GCP KMS keys support multiple versions for key rotation:

- `latest_version`: The most recent version created (read-only)
- `primary_version`: The version used by default for new operations (read-only)
