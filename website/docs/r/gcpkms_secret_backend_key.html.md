---
layout: "vault"
page_title: "Vault: vault_gcpkms_secret_backend_key resource"
sidebar_current: "docs-vault-resource-gcpkms-secret-backend-key"
description: |-
  Manages keys in the GCP KMS secrets engine
---

# vault\_gcpkms\_secret\_backend\_key

Manages keys in the GCP KMS secrets engine. This resource creates or registers GCP KMS crypto keys
within a Vault-managed key ring, making them available for cryptographic operations (encryption,
decryption, signing, verification) through Vault.

~> **Important** All data provided in the resource configuration will be written in cleartext to
state and plan files generated by Terraform, and will appear in the console output when Terraform
runs. Protect these artifacts accordingly. See
[the main provider documentation](../index.html.markdown) for more details.

## Example Usage

### Symmetric Encryption Key

```hcl
resource "vault_gcpkms_secret_backend" "gcpkms" {
  path                   = "gcpkms"
  credentials_wo         = file("gcp-credentials.json")
  credentials_wo_version = 1
}

resource "vault_gcpkms_secret_backend_key" "encryption" {
  mount            = vault_gcpkms_secret_backend.gcpkms.path
  name             = "my-encryption-key"
  key_ring         = "projects/my-project/locations/us-central1/keyRings/my-keyring"
  purpose          = "encrypt_decrypt"
  algorithm        = "symmetric_encryption"
  protection_level = "software"
  rotation_period  = "2592000s"  # 30 days

  labels = {
    env        = "production"
    managed_by = "terraform"
  }
}
```

### Asymmetric Signing Key

```hcl
resource "vault_gcpkms_secret_backend_key" "signing" {
  mount     = vault_gcpkms_secret_backend.gcpkms.path
  name      = "my-signing-key"
  key_ring  = "projects/my-project/locations/us-central1/keyRings/my-keyring"
  purpose   = "asymmetric_sign"
  algorithm = "rsa_sign_pss_2048_sha256"
}
```

### Asymmetric Decryption Key

```hcl
resource "vault_gcpkms_secret_backend_key" "decrypt" {
  mount     = vault_gcpkms_secret_backend.gcpkms.path
  name      = "my-decrypt-key"
  key_ring  = "projects/my-project/locations/us-central1/keyRings/my-keyring"
  purpose   = "asymmetric_decrypt"
  algorithm = "rsa_decrypt_oaep_2048_sha256"
}
```

### HSM-Protected Key

```hcl
resource "vault_gcpkms_secret_backend_key" "hsm" {
  mount            = vault_gcpkms_secret_backend.gcpkms.path
  name             = "hsm-key"
  key_ring         = "projects/my-project/locations/us-central1/keyRings/hsm-keyring"
  purpose          = "encrypt_decrypt"
  algorithm        = "symmetric_encryption"
  protection_level = "hsm"
  rotation_period  = "7776000s"  # 90 days
}
```

### Custom GCP Crypto Key Name

By default, the GCP KMS crypto key uses the same name as the Vault key. Override it with `crypto_key`:

```hcl
resource "vault_gcpkms_secret_backend_key" "custom" {
  mount      = vault_gcpkms_secret_backend.gcpkms.path
  name       = "vault-key-name"
  key_ring   = "projects/my-project/locations/us-central1/keyRings/my-keyring"
  crypto_key = "different-gcp-key-name"
  purpose    = "encrypt_decrypt"
}
```

### Updating Rotation Period

Only `rotation_period` and `labels` can be updated in-place. All other fields require resource replacement.

```hcl
resource "vault_gcpkms_secret_backend_key" "updatable" {
  mount           = vault_gcpkms_secret_backend.gcpkms.path
  name            = "my-key"
  key_ring        = "projects/my-project/locations/us-central1/keyRings/my-keyring"
  rotation_period = "72h"  # Duration strings ("72h") and second strings ("259200s") are both accepted

  labels = {
    version = "v2"
  }
}
```

## Argument Reference

The following arguments are supported:

* `namespace` - (Optional) The namespace of the target resource.
  The value should not contain leading or trailing forward slashes.
  The `namespace` is always relative to the provider's configured
  [namespace](/docs/providers/vault/index.html#namespace).
  *Available only for Vault Enterprise*.

* `mount` - (Required, Forces new resource) Path where the GCP KMS secrets engine is mounted.

* `name` - (Required, Forces new resource) Name of the key in Vault. Used to reference the key for
  cryptographic operations.

* `key_ring` - (Required, Forces new resource) Full resource name of the GCP KMS key ring where the
  crypto key will be created. Format:
  `projects/{project}/locations/{location}/keyRings/{keyring}`

* `crypto_key` - (Optional, Forces new resource) Name of the crypto key in GCP KMS. Defaults to the
  Vault key name if not specified. If the crypto key does not exist in GCP, Vault will create it.

* `purpose` - (Optional, Computed, Forces new resource) Purpose of the key. Vault stores and returns
  this value in lowercase. Valid values:
  - `encrypt_decrypt` — Symmetric encryption/decryption (default)
  - `asymmetric_sign` — Asymmetric signing and verification
  - `asymmetric_decrypt` — Asymmetric decryption

* `algorithm` - (Optional, Computed, Forces new resource) Algorithm for the key. Vault stores and
  returns this value in lowercase. Defaults to `symmetric_encryption` for `encrypt_decrypt` keys.
  Valid values depend on `purpose`:

  For `encrypt_decrypt`:
  - `symmetric_encryption` (default)

  For `asymmetric_sign`:
  - `rsa_sign_pss_2048_sha256`
  - `rsa_sign_pss_3072_sha256`
  - `rsa_sign_pss_4096_sha256`
  - `rsa_sign_pkcs1_2048_sha256`
  - `rsa_sign_pkcs1_3072_sha256`
  - `rsa_sign_pkcs1_4096_sha256`
  - `ec_sign_p256_sha256`
  - `ec_sign_p384_sha384`

  For `asymmetric_decrypt`:
  - `rsa_decrypt_oaep_2048_sha256`
  - `rsa_decrypt_oaep_3072_sha256`
  - `rsa_decrypt_oaep_4096_sha256`

* `protection_level` - (Optional, Computed, Forces new resource) Protection level for the key. Vault
  stores and returns this value in lowercase. Valid values:
  - `software` — Software-protected key (default)
  - `hsm` — Hardware Security Module protected key

* `rotation_period` - (Optional) Rotation period for the key. Accepts Go duration strings (e.g.
  `"72h"`, `"30m"`) or explicit second strings (e.g. `"2592000s"`). Only valid for `encrypt_decrypt`
  keys. Can be updated after creation without replacing the resource.

  The value you set here is preserved **exactly** in state to avoid format drift. Use the computed
  `rotation_schedule_seconds` attribute to read the canonical numeric value that Vault stores.

* `labels` - (Optional) Map of labels to apply to the GCP KMS crypto key. Can be updated after
  creation without replacing the resource.

## Attributes Reference

In addition to the arguments above, the following attributes are exported:

* `id` - The Vault path for the key. Format: `{mount}/keys/{name}`

* `primary_version` - The primary version number of the GCP KMS crypto key used for new
  cryptographic operations. Increments only when a key rotation occurs in GCP.

* `latest_version` - The latest version number of the GCP KMS crypto key.

* `rotation_schedule_seconds` - The rotation period in seconds as stored and returned by Vault. For
  example, if `rotation_period = "72h"` then this will be `259200`. Always refreshed from the API on
  each read. Set to `null` for asymmetric keys.

* `next_rotation_time_seconds` - Unix timestamp (seconds since epoch) of the next scheduled key
  rotation. Only set for `encrypt_decrypt` keys that have a `rotation_period` configured. Set to
  `null` for asymmetric keys and symmetric keys without rotation. Always refreshed from the API.

## Import

GCP KMS keys can be imported using the format `{mount}/keys/{name}`:

```
$ terraform import vault_gcpkms_secret_backend_key.encryption gcpkms/keys/my-encryption-key
```

~> **Note:** After import, `rotation_period` will be populated from the API as `"{N}s"` (e.g.
`"2592000s"`). If your configuration uses a different format (e.g. `"720h"`), Terraform will show a
diff on the next plan. Update your configuration to match, or leave `rotation_period` unset to
accept the API-formatted value.

## Key Purposes and Algorithms

### Encryption Keys (`encrypt_decrypt`)

Used for symmetric encryption and decryption operations. These keys use the `symmetric_encryption`
algorithm and support automatic key rotation via `rotation_period`. Use them with the
`vault_gcpkms_encrypt` and `vault_gcpkms_decrypt` ephemeral resources.

Supported algorithms:
- `symmetric_encryption` (default and only option)

### Signing Keys (`asymmetric_sign`)

Used for digital signing and verification. These keys do not support rotation. Use them with the
`vault_gcpkms_sign` ephemeral resource and `vault_gcpkms_verify` data source.

Supported algorithms:

| Algorithm | Key type | Hash |
|---|---|---|
| `rsa_sign_pss_2048_sha256` | RSA 2048-bit | SHA-256 |
| `rsa_sign_pss_3072_sha256` | RSA 3072-bit | SHA-256 |
| `rsa_sign_pss_4096_sha256` | RSA 4096-bit | SHA-256 |
| `rsa_sign_pkcs1_2048_sha256` | RSA 2048-bit (PKCS#1) | SHA-256 |
| `rsa_sign_pkcs1_3072_sha256` | RSA 3072-bit (PKCS#1) | SHA-256 |
| `rsa_sign_pkcs1_4096_sha256` | RSA 4096-bit (PKCS#1) | SHA-256 |
| `ec_sign_p256_sha256` | EC P-256 | SHA-256 |
| `ec_sign_p384_sha384` | EC P-384 | SHA-384 |

### Asymmetric Decryption Keys (`asymmetric_decrypt`)

Used for asymmetric encryption where data is encrypted with the public key and decrypted with the
private key via Vault. These keys do not support rotation.

Supported algorithms:

| Algorithm | Key type | Hash |
|---|---|---|
| `rsa_decrypt_oaep_2048_sha256` | RSA 2048-bit | SHA-256 |
| `rsa_decrypt_oaep_3072_sha256` | RSA 3072-bit | SHA-256 |
| `rsa_decrypt_oaep_4096_sha256` | RSA 4096-bit | SHA-256 |

## Version Management

GCP KMS keys support multiple versions for key rotation:

- `primary_version` — The version used by default for new cryptographic operations. Only changes
  when a key rotation occurs in GCP KMS (triggered by `rotation_period`). Preserved in state between
  applies using `UseStateForUnknown`.
- `latest_version` — The most recently created version. Equal to `primary_version` in most cases.
- `rotation_schedule_seconds` — The rotation interval in seconds exactly as stored by Vault.
  Refreshed from the API on every read.
- `next_rotation_time_seconds` — Unix timestamp of the next scheduled rotation. Refreshed from the
  API on every read. Useful for alerting or audit purposes.
