---
layout: "vault"
page_title: "Vault: vault_aws_secret_backend resource"
sidebar_current: "docs-vault-resource-aws-secret-backend"
description: |-
  Creates an AWS secret backend for Vault.
---

# vault\_aws\_secret\_backend

Creates an AWS Secret Backend for Vault. AWS secret backends can then issue AWS
access keys and secret keys, once a role has been added to the backend.

~> **Important** All data provided in the resource configuration will be
written in cleartext to state and plan files generated by Terraform, and
will appear in the console output when Terraform runs. Protect these
artifacts accordingly. See
[the main provider documentation](../index.html)
for more details.

## Example Usage

```hcl
resource "vault_aws_secret_backend" "aws" {
  access_key = "AKIA....."
  secret_key = "AWS secret key"
  rotation_schedule = "0 * * * SAT"
  rotation_window = 3600
}
```

### Using Write-Only Secret Key

The `secret_key_wo` field allows you to configure the AWS secret key without 
storing it in Terraform state. This is recommended for enhanced security.

```hcl
resource "vault_aws_secret_backend" "aws" {
  access_key           = "AKIA....."
  secret_key_wo        = var.aws_secret_key
  secret_key_wo_version = 1
  rotation_schedule    = "0 * * * SAT"
  rotation_window      = 3600
}
```

To update the `secret_key_wo` value, increment the `secret_key_wo_version`:

```hcl
resource "vault_aws_secret_backend" "aws" {
  access_key           = "AKIA....."
  secret_key_wo        = var.aws_secret_key
  secret_key_wo_version = 2  # Increment to trigger update
  rotation_schedule    = "0 * * * SAT"
  rotation_window      = 3600
}
```

### Using Workload Identity Federation

```hcl
resource "vault_aws_secret_backend" "aws" { 
  identity_token_audience   = "<TOKEN_AUDIENCE>"
  identity_token_ttl        = "<TOKEN_TTL>"
  role_arn		    = "<AWS_ROLE_ARN>"
  rotation_schedule = "0 * * * SAT"
  rotation_window = 3600
}
```

## Argument Reference

The following arguments are supported:

* `namespace` - (Optional) The namespace to provision the resource in.
  The value should not contain leading or trailing forward slashes.
  The `namespace` is always relative to the provider's configured [namespace](/docs/providers/vault/index.html#namespace).
   *Available only for Vault Enterprise*.

* `access_key` - (Optional) The AWS Access Key ID this backend should use to
issue new credentials. Vault uses the official AWS SDK to authenticate, and thus can also use standard AWS environment credentials, shared file credentials or IAM role/ECS task credentials.

* `secret_key` - (Optional) The AWS Secret Key this backend should use to
issue new credentials. Vault uses the official AWS SDK to authenticate, and thus can also use standard AWS environment credentials, shared file credentials or IAM role/ECS task credentials. Conflicts with `secret_key_wo`.

~> **Important** Vault version 1.2.3 and older does not support reading the configured
credentials back from the API, With these older versions, Terraform cannot detect and correct drift
on `access_key` or `secret_key`. Changing the values, however, _will_
overwrite the previously stored values. With versions of Vault newer than
1.2.3, reading the `access_key` only is supported, and so drifts of the
`access_key` will be detected and corrected, but drifts on the `secret_key`
will not.

* `region` - (Optional) The AWS region for API calls. Defaults to `us-east-1`.

~> **Important** The same limitation noted above for the `access_key` parameter
also applies to the `region` parameter. Vault versions 1.2.3 and older will not
allow Terraform to detect (and thus correct) drift in the `region` parameter,
while newer versions of Vault will.

* `path` - (Optional) The unique path this backend should be mounted at. Must
not begin or end with a `/`. Defaults to `aws`.

* `disable_remount` - (Optional) If set, opts out of mount migration on path updates.
  See here for more info on [Mount Migration](https://www.vaultproject.io/docs/concepts/mount-migration)

* `iam_endpoint` - (Optional) Specifies a custom HTTP IAM endpoint to use.

* `sts_endpoint` - (Optional) Specifies a custom HTTP STS endpoint to use.

* `sts_region` - (Optional) Specifies the region of the STS endpoint. Should be included if `sts_endpoint` is supplied. Requires Vault 1.19+

* `sts_fallback_endpoints` - (Optional) Ordered list of `sts_endpoint`s to try if the defined one fails. Requires Vault 1.19+

* `sts_fallback_regions` - (Optional) Ordered list of `sts_region`s matching the fallback endpoints. Should correspond in order with those endpoints. Requires Vault 1.19+

* `identity_token_audience` - (Optional) The audience claim value. Requires Vault 1.16+.

* `identity_token_ttl` - (Optional) The TTL of generated identity tokens in seconds. Requires Vault 1.16+.

* `max_retries` - (Optional) Number of max retries the client should use for recoverable errors.

* `role_arn` - (Optional) Role ARN to assume for plugin identity token federation. Requires Vault 1.16+.

* `rotation_period` - (Optional) The amount of time in seconds Vault should wait before rotating the root credential. 
A zero value tells Vault not to rotate the root credential. The minimum rotation period is 10 seconds. Requires Vault Enterprise 1.19+.

* `rotation_schedule` - (Optional) The schedule, in [cron-style time format](https://en.wikipedia.org/wiki/Cron),
defining the schedule on which Vault should rotate the root token. Requires Vault Enterprise 1.19+.

* `rotation_window` - (Optional) The maximum amount of time in seconds allowed to complete
a rotation when a scheduled token rotation occurs. The default rotation window is
unbound and the minimum allowable window is `3600`. Requires Vault Enterprise 1.19+.

* `disable_automated_rotation` - (Optional) Cancels all upcoming rotations of the root credential until unset. Requires Vault Enterprise 1.19+.

* `username_template` - (Optional)  Template describing how dynamic usernames are generated. The username template is used to generate both IAM usernames (capped at 64 characters) and STS usernames (capped at 32 characters). If no template is provided the field defaults to the template:

```
{{ if (eq .Type "STS") }}
    {{ printf "vault-%s-%s" (unix_time) (random 20) | truncate 32 }}
{{ else }}
    {{ printf "vault-%s-%s-%s" (printf "%s-%s" (.DisplayName) (.PolicyName) | truncate 42) (unix_time) (random 20) | truncate 64 }}
{{ end }}

```

### Common Mount Arguments
These arguments are common across all resources that mount a secret engine.

* `description` - (Optional) Human-friendly description of the mount

* `default_lease_ttl_seconds` - (Optional) Default lease duration for tokens and secrets in seconds

* `max_lease_ttl_seconds` - (Optional) Maximum possible lease duration for tokens and secrets in seconds

* `audit_non_hmac_response_keys` - (Optional) Specifies the list of keys that will not be HMAC'd by audit devices in the response data object.

* `audit_non_hmac_request_keys` - (Optional) Specifies the list of keys that will not be HMAC'd by audit devices in the request data object.

* `local` - (Optional) Boolean flag that can be explicitly set to true to enforce local mount in HA environment

* `options` - (Optional) Specifies mount type specific options that are passed to the backend

* `seal_wrap` - (Optional) Boolean flag that can be explicitly set to true to enable seal wrapping for the mount, causing values stored by the mount to be wrapped by the seal's encryption capability

* `external_entropy_access` - (Optional) Boolean flag that can be explicitly set to true to enable the secrets engine to access Vault's external entropy source

* `allowed_managed_keys` - (Optional) Set of managed key registry entry names that the mount in question is allowed to access

* `listing_visibility` - (Optional) Specifies whether to show this mount in the UI-specific
  listing endpoint. Valid values are `unauth` or `hidden`. If not set, behaves like `hidden`.

* `passthrough_request_headers` - (Optional) List of headers to allow and pass from the request to
  the plugin.

* `allowed_response_headers` - (Optional) List of headers to allow, allowing a plugin to include
  them in the response.

* `delegated_auth_accessors` - (Optional)  List of allowed authentication mount accessors the
  backend can request delegated authentication for.

* `plugin_version` - (Optional) Specifies the semantic version of the plugin to use, e.g. "v1.0.0".
  If unspecified, the server will select any matching unversioned plugin that may have been
  registered, the latest versioned plugin registered, or a built-in plugin in that order of precedence.

* `identity_token_key` - (Optional)  The key to use for signing plugin workload identity tokens. If
  not provided, this will default to Vault's OIDC default key. Requires Vault Enterprise 1.16+.

## Ephemeral Attributes Reference

These attributes are write-only and will not be persisted to Terraform state. 
Requires Terraform 1.11+.

* `secret_key_wo` - (Optional) The AWS Secret Key this backend should use to
issue new credentials. This is a write-only field and will not be stored in state. 
Vault uses the official AWS SDK to authenticate, and thus can also use standard AWS 
environment credentials, shared file credentials or IAM role/ECS task credentials. 
Conflicts with `secret_key`.

* `secret_key_wo_version` - (Optional, Required if `secret_key_wo` is set) A version counter for the 
`secret_key_wo` field. Incrementing this value will trigger an update to the secret key.

## Attributes Reference

No additional attributes are exported by this resource.

## Import

AWS secret backends can be imported using the `path`, e.g.

```
$ terraform import vault_aws_secret_backend.aws aws
```

## Tutorials

Refer to the [Inject Secrets into Terraform Using the Vault Provider](https://learn.hashicorp.com/tutorials/terraform/secrets-vault) tutorial for a step-by-step usage example.
