---
layout: "vault"
page_title: "Vault: vault_spiffe_auth_backend_role resource"
sidebar_current: "docs-vault-resource-vault-spiffe-auth-backend-role"
description: |-
 Manage a named role within a SPIFFE auth backend that maps SPIFFE IDs to Vault policies.
---

# vault\_spiffe\_auth\_backend\_role

Manage a named role within a SPIFFE auth backend. The role defines a mapping
from SPIFFE IDs to Vault policies along with other parameters that influence
the token that gets created upon successful authentication.

~> **Important** All data provided in the resource configuration will be
written in cleartext to state and plan files generated by Terraform, and
will appear in the console output when Terraform runs. Protect these
artifacts accordingly. See
[the main provider documentation](../index.html)
for more details.

## Example Usage

```hcl
resource "vault_auth_backend" "spiffe_mount" {
  type = "spiffe"
  path = "spiffe"

  tune {
    passthrough_request_headers = ["Authorization"]
  }
}

resource "vault_spiffe_auth_backend_role" "spiffe_role" {
  mount        = vault_auth_backend.spiffe_mount.path
  name         = "example-role"
  workload_id_patterns = ["/env/+/svc/web", "/env/+/svc/db"]
  token_ttl = 3600
  token_max_ttl = 7200
  token_policies = ["example"]
  token_bound_cidrs = ["127.0.0.1"]
  token_explicit_max_ttl = 10800
  token_no_default_policy = true
  token_num_uses = 1
  token_period = 60
  token_type = "service"
  alias_metadata = { 
    "metadata-key" = "metadata-value" 
  }
}
```

## Argument Reference

The following arguments are supported:

* `namespace` - (Optional) The namespace to provision the resource in.
  The value should not contain leading or trailing forward slashes.
  The `namespace` is always relative to the provider's configured [namespace](/docs/providers/vault/index.html#namespace).
   *Available only for Vault Enterprise*.

* `mount` - (Required) The PKI secret backend the resource belongs to.

* `workload_id_patterns` - (Required) A comma separated list of patterns that match an 
incoming workload ID within the SVID document presented by the client.

* `display_name` - (Optional) The human-readable name for tokens issued when
authenticating against the role. Defaults to the value provided for `mount`. 
 
### Common Token Arguments

These arguments are common across several Authentication Token resources since Vault 1.2.

* `token_ttl` - (Optional) The incremental lifetime for generated tokens in number of seconds.
  Its current value will be referenced at renewal time.

* `token_max_ttl` - (Optional) The maximum lifetime for generated tokens in number of seconds.
  Its current value will be referenced at renewal time.

* `token_period` - (Optional) If set, indicates that the
  token generated using this role should never expire. The token should be renewed within the
  duration specified by this value. At each renewal, the token's TTL will be set to the
  value of this field. Specified in seconds.

* `token_policies` - (Optional) List of policies to encode onto generated tokens. Depending
  on the auth method, this list may be supplemented by user/group/other values.

* `token_bound_cidrs` - (Optional) List of CIDR blocks; if set, specifies blocks of IP
  addresses which can authenticate successfully, and ties the resulting token to these blocks
  as well.

* `token_explicit_max_ttl` - (Optional) If set, will encode an
  [explicit max TTL](https://www.vaultproject.io/docs/concepts/tokens.html#token-time-to-live-periodic-tokens-and-explicit-max-ttls)
  onto the token in number of seconds. This is a hard cap even if `token_ttl` and
  `token_max_ttl` would otherwise allow a renewal.

* `token_no_default_policy` - (Optional) If set, the default policy will not be set on
  generated tokens; otherwise it will be added to the policies set in token_policies.

* `token_num_uses` - (Optional) The [maximum number](https://developer.hashicorp.com/vault/api-docs/auth/saml#token_num_uses)
  of times a generated token may be used (within its lifetime); 0 means unlimited.

* `token_type` - (Optional) The type of token that should be generated. Can be `service`,
  `batch`, or `default` to use the mount's tuned default (which unless changed will be
  `service` tokens). For token store roles, there are two additional possibilities:
  `default-service` and `default-batch` which specify the type to return unless the client
  requests a different type at generation time.

* `alias_metadata` - (Optional) A mapping of string key-value pairs that will be set as
  metadata on the token's alias. This can be used to store information about the
  authenticated entity.

## Attributes Reference

No additional attributes are exported by this resource.

## Import

The SPIFFE role can be imported using the resource's `id`.
In the case of the example above the `id` would be `auth/spiffe/role/example-role`,
where the `spiffe` component is the resource's `mount`, e.g.

```
$ terraform import vault_spiffe_auth_backend_role.spiffe_role auth/spiffe/role/example-role
```
