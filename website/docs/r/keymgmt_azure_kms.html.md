---
layout: "vault"
page_title: "Vault: vault_keymgmt_azure_kms resource"
sidebar_current: "docs-vault-resource-keymgmt-azure-kms"
description: |-
  Manages Azure Key Vault provider in the Vault Key Management secrets engine
---

# vault\_keymgmt\_azure\_kms

Manages an Azure Key Vault provider in the Vault Key Management secrets engine. This resource configures Vault to integrate with Azure Key Vault, allowing keys created in Vault to be distributed to Azure Key Vault for use in Azure services.

Once configured, keys can be distributed to Azure Key Vault using the `vault_keymgmt_distribute_key` resource.

~> **Important** All data provided in the resource configuration will be
written in cleartext to state and plan files generated by Terraform, and
will appear in the console output when Terraform runs. Protect these
artifacts accordingly. See
[the main provider documentation](../index.html)
for more details.

**Note** this feature is available only with Vault Enterprise.

## Example Usage

### Basic Configuration

```hcl
resource "vault_mount" "keymgmt" {
  path = "keymgmt"
  type = "keymgmt"
}

resource "vault_keymgmt_azure_kms" "production" {
  path           = vault_mount.keymgmt.path
  name           = "azure-production"
  key_collection = "my-keyvault"
  tenant_id      = var.azure_tenant_id
  client_id      = var.azure_client_id
  client_secret  = var.azure_client_secret
  environment    = "AzurePublicCloud"
}
```

### Using Azure Government Cloud

```hcl
resource "vault_keymgmt_azure_kms" "government" {
  path           = vault_mount.keymgmt.path
  name           = "azure-government"
  key_collection = "gov-keyvault"
  tenant_id      = var.azure_tenant_id
  client_id      = var.azure_client_id
  client_secret  = var.azure_client_secret
  environment    = "AzureUSGovernmentCloud"
}
```

### Complete Example with Key Distribution

```hcl
resource "vault_keymgmt_azure_kms" "azure" {
  path           = vault_mount.keymgmt.path
  name           = "azure-kv"
  key_collection = "production-keyvault"
  tenant_id      = var.azure_tenant_id
  client_id      = var.azure_client_id
  client_secret  = var.azure_client_secret
  environment    = "AzurePublicCloud"
}

resource "vault_keymgmt_key" "encryption_key" {
  path = vault_mount.keymgmt.path
  name = "azure-encryption-key"
  type = "rsa-2048"
}

resource "vault_keymgmt_distribute_key" "azure_dist" {
  path     = vault_mount.keymgmt.path
  kms_name = vault_keymgmt_azure_kms.azure.name
  key_name = vault_keymgmt_key.encryption_key.name
  purpose  = ["encrypt", "decrypt"]
}
```

## Argument Reference

The following arguments are supported:

* `namespace` - (Optional) The namespace of the target resource.
  The value should not contain leading or trailing forward slashes.
  The `namespace` is always relative to the provider's configured
  [namespace](/docs/providers/vault/index.html#namespace).
  *Available only for Vault Enterprise*.

* `path` - (Required) Path where the Key Management secrets engine is mounted.

* `name` - (Required) Unique name for this Azure Key Vault provider. This cannot be changed after creation.

* `key_collection` - (Required) Name of the Azure Key Vault where keys will be created.

* `tenant_id` - (Required) Azure Active Directory tenant ID (also called Directory ID).

* `client_id` - (Required, Sensitive) Azure Active Directory application/client ID for the service principal.

* `client_secret` - (Required, Sensitive) Azure Active Directory client secret for the service principal.

* `environment` - (Optional) Azure cloud environment. Valid values are:
  - `AzurePublicCloud` (default) - Azure public cloud
  - `AzureUSGovernmentCloud` - Azure US Government cloud
  - `AzureChinaCloud` - Azure China cloud
  - `AzureGermanCloud` - Azure German cloud

## Attributes Reference

In addition to the arguments above, the following attributes are exported:

* `id` - The unique identifier for the Azure Key Vault provider. Format: `{path}/kms/{name}`

## Import

Azure Key Vault providers can be imported using the format `{path}/kms/{name}`, e.g.

```
$ terraform import vault_keymgmt_azure_kms.production keymgmt/kms/azure-production
```

~> **Note:** When importing, the `client_id` and `client_secret` fields will not be populated as they are write-only and not returned by the Vault API.

## Required Azure Permissions

The Azure service principal must have the following permissions on the Key Vault:

### Key Vault Access Policies

The service principal needs these Key Vault permissions:

**Key Permissions:**
- `Create` - To create new keys
- `Get` - To read key information
- `List` - To list keys
- `Update` - To update key properties
- `Delete` - To delete keys (when deletion_allowed is true)
- `Backup` - To backup keys
- `Restore` - To restore keys
- `Encrypt` - To perform encryption operations
- `Decrypt` - To perform decryption operations
- `Sign` - To perform signing operations
- `Verify` - To perform verification operations
- `WrapKey` - To wrap keys
- `UnwrapKey` - To unwrap keys

### Example Azure CLI Command

```bash
# Grant access policy to the service principal
az keyvault set-policy \
  --name my-keyvault \
  --spn <client-id> \
  --key-permissions create get list update delete backup restore encrypt decrypt sign verify wrapKey unwrapKey
```

### Example using Azure Resource Manager (ARM) Template

```json
{
  "type": "Microsoft.KeyVault/vaults/accessPolicies",
  "apiVersion": "2021-06-01-preview",
  "name": "[concat(parameters('keyVaultName'), '/add')]",
  "properties": {
    "accessPolicies": [
      {
        "tenantId": "[parameters('tenantId')]",
        "objectId": "[parameters('servicePrincipalObjectId')]",
        "permissions": {
          "keys": [
            "create",
            "get",
            "list",
            "update",
            "delete",
            "backup",
            "restore",
            "encrypt",
            "decrypt",
            "sign",
            "verify",
            "wrapKey",
            "unwrapKey"
          ]
        }
      }
    ]
  }
}
```

## Azure Environments

Different Azure environments use different API endpoints:

- **AzurePublicCloud**: Standard Azure cloud (most common)
- **AzureUSGovernmentCloud**: Azure Government for US government agencies
- **AzureChinaCloud**: Azure operated by 21Vianet in China
- **AzureGermanCloud**: Azure Germany cloud

## Key Distribution

After configuring the Azure Key Vault provider, use the `vault_keymgmt_distribute_key` resource to distribute Vault keys to Azure Key Vault. The distributed keys can then be used by Azure services for encryption, decryption, signing, and verification operations.
