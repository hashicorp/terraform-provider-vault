---
layout: "vault"
page_title: "Vault: vault_spiffe_auth_backend_config resource"
sidebar_current: "docs-vault-resource-vault-spiffe-auth-backend-config"
description: |-
  Update the main configuration of the SPIFFE auth backend in Vault.
---

# vault\_spiffe\_auth\_backend\_config

Configure the SPIFFE trust domain and associated trust bundle for the backend

~> **Important** All data provided in the resource configuration will be
written in cleartext to state and plan files generated by Terraform, and
will appear in the console output when Terraform runs. Protect these
artifacts accordingly. See
[the main provider documentation](../index.html)
for more details.

## Example Usage

```hcl
resource "vault_auth_backend" "spiffe_mount" {
  type = "spiffe"
  path = "spiffe"

  tune {
    passthrough_request_headers = ["Authorization"]
  }
}

resource "vault_spiffe_auth_backend_config" "spiffe_config" {
  mount        = vault_auth_backend.spiffe_mount.path
  trust_domain = "example.org"
  profile      = "https_web_bundle"
  endpoint_url = "https://example.org:8443/"
}
```

## Argument Reference

The following arguments are supported:

* `namespace` - (Optional) The namespace to provision the resource in.
  The value should not contain leading or trailing forward slashes.
  The `namespace` is always relative to the provider's configured [namespace](/docs/providers/vault/index.html#namespace).
   *Available only for Vault Enterprise*.

* `mount` - (Required) The PKI secret backend the resource belongs to.

* `trust_domain` - (Required)  The SPIFFE trust domain used by the backend. 
 
* `profile` - (Required) Sets the profile type and fetch mechanism for the profile
used to fetch the trust bundle. Must be one of: 
  * https_spiffe_bundle - fetch the trust bundle in JWKS format from a SPIFFE endpoint.
  * https_web_bundle - fetch the trust bundle in JWKS format from an HTTPS endpoint.
  * https_web_pem - fetch a valid X.509 certificate as the trust bundle from an HTTPS endpoint.
  * static - use the trust bundle explicitly configured in the profile definition.

* `audience` - (Optional) A list of allowed audience values for JWT based SVIDs.

* `defer_bundle_fetch` - (Optional) If true, tells Vault not to fetch the remote trust
bundle to validate the configuration
 
* `bundle` - (Optional) A PEM encoded X.509 certificate or a JWKS document based on what
the `profile` argument is set. 

* `endpoint_url` - (Optional) The URL to fetch the trust bundle from. Required if the
`profile` argument is set to `https_spiffe_bundle`, `https_web_bundle`, or
`https_web_pem`.

* `endpoint_root_ca_truststore_pem` - (Optional) A PEM encoded CA certificate to use
to validate the TLS connection to the `endpoint_url` when the `profile` argument 
is set to `https_web_bundle` or `https_web_pem`.

* `endpoint_spiffe_id` - (Optional) The SPIFFE ID to expect in the TLS certificate when
the `profile` argument is set to `https_spiffe_bundle`.

## Attributes Reference

No additional attributes are exported by this resource.

## Import

The SPIFFE config can be imported using the resource's `id`.
In the case of the example above the `id` would be `auth/spiffe/config`,
where the `spiffe` component is the resource's `mount`, e.g.

```
$ terraform import vault_spiffe_auth_backend_config.spiffe_config auth/spiffe/config
```
