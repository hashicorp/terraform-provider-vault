---
layout: "vault"
page_title: "Vault: vault_keymgmt_aws_kms resource"
description: |-
  Manages AWS KMS provider in the Vault Key Management secrets engine
---

# vault\_keymgmt\_aws\_kms

Manages an AWS KMS provider in the Vault Key Management secrets engine. This resource configures Vault to integrate with AWS Key Management Service, allowing keys created in Vault to be distributed to AWS KMS for use in AWS services.

Once configured, keys can be distributed to AWS KMS using the `vault_keymgmt_distribute_key` resource.

~> **Important** All data provided in the resource configuration will be
written in cleartext to state and plan files generated by Terraform, and
will appear in the console output when Terraform runs. Protect these
artifacts accordingly. See
[the main provider documentation](../index.html)
for more details.

**Note** this feature is available only with Vault Enterprise.

## Example Usage

### Basic Configuration

```hcl
resource "vault_mount" "keymgmt" {
  path = "keymgmt"
  type = "keymgmt"
}

resource "vault_keymgmt_aws_kms" "us_west" {
  path           = vault_mount.keymgmt.path
  name           = "aws-us-west-2"
  key_collection = "us-west-2"
  
  access_key = var.aws_access_key_id
  secret_key = var.aws_secret_access_key
}
```

### Using AWS Environment Variables or IAM Roles

```hcl
# When credentials are not provided, Vault will use AWS SDK's credential chain:
# 1. Environment variables (AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, AWS_SESSION_TOKEN)
# 2. Shared credentials file (~/.aws/credentials)
# 3. IAM instance profile (when running on EC2)
# 4. ECS task credentials (when running on ECS)

resource "vault_keymgmt_aws_kms" "production" {
  path           = vault_mount.keymgmt.path
  name           = "aws-production"
  key_collection = "us-east-1"
  
  # No access_key or secret_key - Vault uses AWS credential chain
}

# Distribute a key to AWS KMS
resource "vault_keymgmt_key" "encryption_key" {
  path = vault_mount.keymgmt.path
  name = "aws-encryption-key"
  type = "aes256-gcm96"
}

resource "vault_keymgmt_distribute_key" "aws_dist" {
  path     = vault_mount.keymgmt.path
  kms_name = vault_keymgmt_aws_kms.production.name
  key_name = vault_keymgmt_key.encryption_key.name
  purpose  = ["encrypt", "decrypt"]
}
```

### Using Multiple Credential Methods

```hcl
# Option 1: Map-based credentials
resource "vault_keymgmt_aws_kms" "map_creds" {
  path           = vault_mount.keymgmt.path
  name           = "aws-map-creds"
  key_collection = "us-west-2"
  
  credentials = {
    access_key = var.aws_access_key_id
    secret_key = var.aws_secret_access_key
  }
}

# Option 2: Individual credential fields
resource "vault_keymgmt_aws_kms" "individual_creds" {
  path           = vault_mount.keymgmt.path
  name           = "aws-individual-creds"
  key_collection = "eu-west-1"
  
  access_key = var.aws_access_key_id
  secret_key = var.aws_secret_access_key
}
```

## Argument Reference

The following arguments are supported:

* `namespace` - (Optional) The namespace of the target resource.
  The value should not contain leading or trailing forward slashes.
  The `namespace` is always relative to the provider's configured
  [namespace](/docs/providers/vault/index.html#namespace).
  *Available only for Vault Enterprise*.

* `path` - (Required) Path where the Key Management secrets engine is mounted.

* `name` - (Required) Unique name for this AWS KMS provider. This cannot be changed after creation.

* `key_collection` - (Required) AWS region where keys will be created. This defines the region for the KMS keys. Examples: `us-west-2`, `us-east-1`, `eu-west-1`. Cannot be changed after creation.

* `credentials` - (Optional, Sensitive) Map containing AWS credentials with keys `access_key` and `secret_key`. Mutually exclusive with `access_key` and `secret_key` fields. If not provided, Vault will use the AWS SDK credential chain (environment variables, IAM roles, etc.).

* `access_key` - (Optional, Sensitive) AWS access key ID with permissions to manage KMS keys. May also be specified by the `AWS_ACCESS_KEY_ID` environment variable on the Vault server. Mutually exclusive with `credentials` map.

* `secret_key` - (Optional, Sensitive) AWS secret access key. May also be specified by the `AWS_SECRET_ACCESS_KEY` environment variable on the Vault server. Mutually exclusive with `credentials` map.

## Attributes Reference

In addition to the arguments above, the following attributes are exported:

* `id` - The unique identifier for the AWS KMS provider. Format: `{path}/kms/{name}`

## Import

AWS KMS providers can be imported using the format `{path}/kms/{name}`, e.g.

```
$ terraform import vault_keymgmt_aws_kms.us_west keymgmt/kms/aws-us-west-2
```

~> **Note:** When importing, the `credentials`, `access_key`, and `secret_key` fields will not be populated as they are write-only and not returned by the Vault API.

## Authentication Methods

This resource supports multiple authentication methods for AWS:

1. **Explicit credentials in Terraform** - Provide `access_key` and `secret_key` (or `credentials` map) directly
2. **Environment variables** - Set `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`, and optionally `AWS_SESSION_TOKEN` on the Vault server
3. **Shared credentials file** - Configure `~/.aws/credentials` on the Vault server
4. **IAM instance profile** - When Vault runs on EC2, it can use the instance's IAM role
5. **ECS task credentials** - When Vault runs on ECS, it can use the task's IAM role

Credentials provided explicitly in Terraform take precedence over environment variables and IAM roles.

## Required AWS Permissions

The AWS credentials provided must have the following IAM permissions:

- `kms:CreateKey` - To create new KMS keys
- `kms:DescribeKey` - To read key information
- `kms:GetPublicKey` - To retrieve public key information for asymmetric keys
- `kms:ScheduleKeyDeletion` - To delete keys (when deletion_allowed is true)
- `kms:ListAliases` - To list key aliases
- `kms:CreateAlias` - To create key aliases
- `kms:DeleteAlias` - To delete key aliases
- `kms:TagResource` - To tag keys
- `kms:UntagResource` - To remove tags from keys

Example IAM policy:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "kms:CreateKey",
        "kms:DescribeKey",
        "kms:GetPublicKey",
        "kms:ScheduleKeyDeletion",
        "kms:ListAliases",
        "kms:CreateAlias",
        "kms:DeleteAlias",
        "kms:TagResource",
        "kms:UntagResource"
      ],
      "Resource": "*"
    }
  ]
}
```

## Key Distribution

After configuring the AWS KMS provider, use the `vault_keymgmt_distribute_key` resource to distribute Vault keys to AWS KMS. The distributed keys can then be used by AWS services for encryption, decryption, signing, and verification operations.
