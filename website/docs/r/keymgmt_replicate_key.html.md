---
layout: "vault"
page_title: "Vault: vault_keymgmt_replicate_key resource"
description: |-
  Replicates keys across regions in AWS KMS (AWS KMS only)
---

# vault\_keymgmt\_replicate\_key

Replicates a key from one Vault region to another in the Key Management secrets engine. This resource is used in multi-region Vault deployments to ensure keys are available across different geographic regions for high availability and disaster recovery.

Key replication allows cryptographic keys to be synchronized between Vault clusters, enabling consistent key management across global deployments.

~> **Important** All data provided in the resource configuration will be
written in cleartext to state and plan files generated by Terraform, and
will appear in the console output when Terraform runs. Protect these
artifacts accordingly. See
[the main provider documentation](../index.html)
for more details.

**Note** this feature is available only with Vault Enterprise with Performance Replication enabled.

## Example Usage

### Basic Key Replication

```hcl
resource "vault_mount" "keymgmt" {
  path = "keymgmt"
  type = "keymgmt"
}

resource "vault_keymgmt_key" "source_key" {
  path = vault_mount.keymgmt.path
  name = "replicated-key"
  type = "aes256-gcm96"
}

resource "vault_keymgmt_replicate_key" "replicate" {
  path     = vault_mount.keymgmt.path
  name     = vault_keymgmt_key.source_key.name
  target   = "secondary-cluster"
}
```

### Replication to Multiple Regions

```hcl
resource "vault_keymgmt_key" "global_key" {
  path = vault_mount.keymgmt.path
  name = "global-encryption-key"
  type = "rsa-2048"
}

# Replicate to US East region
resource "vault_keymgmt_replicate_key" "us_east" {
  path   = vault_mount.keymgmt.path
  name   = vault_keymgmt_key.global_key.name
  target = "vault-us-east"
}

# Replicate to EU region
resource "vault_keymgmt_replicate_key" "eu" {
  path   = vault_mount.keymgmt.path
  name   = vault_keymgmt_key.global_key.name
  target = "vault-eu-west"
}

# Replicate to Asia Pacific region
resource "vault_keymgmt_replicate_key" "apac" {
  path   = vault_mount.keymgmt.path
  name   = vault_keymgmt_key.global_key.name
  target = "vault-apac"
}
```

### Replication with Distributed Keys

```hcl
# Create key
resource "vault_keymgmt_key" "app_key" {
  path = vault_mount.keymgmt.path
  name = "application-key"
  type = "aes256-gcm96"
  
  replica_regions = ["us-west-1", "us-east-1", "eu-west-1"]
}

# Replicate to secondary cluster
resource "vault_keymgmt_replicate_key" "secondary" {
  path   = vault_mount.keymgmt.path
  name   = vault_keymgmt_key.app_key.name
  target = "secondary-vault-cluster"
}

# Distribute to AWS KMS in the primary region
resource "vault_keymgmt_aws_kms" "primary_kms" {
  path           = vault_mount.keymgmt.path
  name           = "aws-primary"
  key_collection = "us-west-1"
  access_key     = var.aws_access_key_id
  secret_key     = var.aws_secret_access_key
}

resource "vault_keymgmt_distribute_key" "primary_dist" {
  path     = vault_mount.keymgmt.path
  kms_name = vault_keymgmt_aws_kms.primary_kms.name
  key_name = vault_keymgmt_key.app_key.name
  purpose  = ["encrypt", "decrypt"]
}
```

## Argument Reference

The following arguments are supported:

* `namespace` - (Optional) The namespace of the target resource.
  The value should not contain leading or trailing forward slashes.
  The `namespace` is always relative to the provider's configured
  [namespace](/docs/providers/vault/index.html#namespace).
  *Available only for Vault Enterprise*.

* `path` - (Required) Path where the Key Management secrets engine is mounted.

* `name` - (Required) Name of the key to replicate (created via `vault_keymgmt_key`).

* `target` - (Required) Name of the target Vault cluster/region to replicate the key to. This must correspond to a configured performance replication secondary cluster.

## Attributes Reference

In addition to the arguments above, the following attributes are exported:

* `id` - The unique identifier for the key replication. Format: `{path}/key/{name}/replicate/{target}`

## Import

Key replication resources can be imported using the format `{path}/key/{name}/replicate/{target}`, e.g.

```
$ terraform import vault_keymgmt_replicate_key.replicate keymgmt/key/replicated-key/replicate/secondary-cluster
```

## Requirements

### Vault Enterprise Performance Replication

This resource requires:
- Vault Enterprise license with Performance Replication enabled
- A primary and at least one secondary cluster configured
- Performance replication active and healthy between clusters

### Cluster Configuration

Before using this resource:

1. Set up Vault Enterprise Performance Replication
2. Configure primary and secondary clusters
3. Ensure clusters can communicate securely
4. Verify replication status is healthy

## Replication Behavior

### Initial Replication

When the resource is created:
1. The key is replicated from the primary cluster to the target secondary
2. All key versions are replicated
3. Key metadata and properties are synchronized
4. The replicated key becomes available on the secondary cluster

### Ongoing Synchronization

After initial replication:
- Key rotations are automatically replicated
- Metadata changes are synchronized
- Version updates propagate to secondaries
- Key distribution status is maintained

### Key Deletion

When the replication resource is destroyed:
- The key remains on the primary cluster
- The key is removed from the target secondary cluster
- Distribution to external KMS providers remains on the primary
- The key can be re-replicated if needed

## Use Cases

### High Availability

Replicate keys across regions to ensure:
- Keys are available if one region fails
- Applications can access keys from the nearest Vault cluster
- Reduced latency for key operations
- Business continuity during regional outages

### Disaster Recovery

Key replication enables:
- Quick recovery from primary cluster failure
- Failover to secondary clusters
- Protection against data center disasters
- Compliance with disaster recovery requirements

### Global Applications

For globally distributed applications:
- Replicate keys to all regions where the application runs
- Reduce network latency for cryptographic operations
- Ensure consistent key availability worldwide
- Support multi-region deployments

### Compliance and Data Residency

Key replication helps meet compliance requirements:
- Keep keys in specific geographic regions
- Meet data residency requirements
- Comply with regional regulations (GDPR, etc.)
- Implement region-specific key management policies

## Performance Replication Prerequisites

### Primary Cluster Configuration

On the primary cluster:

```bash
# Enable performance replication
vault write -f sys/replication/performance/primary/enable

# Generate secondary token
vault write sys/replication/performance/primary/secondary-token id="secondary-cluster"
```

### Secondary Cluster Configuration

On the secondary cluster:

```bash
# Enable performance replication with the token from primary
vault write sys/replication/performance/secondary/enable token="<token-from-primary>"

# Verify replication status
vault read sys/replication/performance/status
```

## Monitoring and Validation

After configuring replication, verify:

1. **Replication Status**: Check that replication is active and healthy
   ```bash
   vault read sys/replication/performance/status
   ```

2. **Key Availability**: Confirm the key exists on the secondary cluster
   ```bash
   vault read keymgmt/key/replicated-key
   ```

3. **Replication Lag**: Monitor replication lag between clusters
   - Check Vault metrics
   - Monitor replication status API
   - Set up alerts for replication issues

4. **Key Versions**: Ensure all key versions are replicated
   ```bash
   vault read keymgmt/key/replicated-key
   ```

## Best Practices

### Network Configuration

- Ensure low-latency, high-bandwidth connections between clusters
- Use dedicated network paths for replication traffic
- Implement network redundancy
- Monitor network performance

### Security

- Use TLS for all replication traffic
- Implement network segmentation
- Restrict access to replication endpoints
- Regularly audit replication configurations

### Operational

- Test failover procedures regularly
- Monitor replication health continuously
- Document replication topology
- Maintain runbooks for replication issues

### Capacity Planning

- Plan for replication bandwidth requirements
- Consider replication lag in SLAs
- Scale infrastructure to support replication load
- Monitor storage requirements on secondary clusters
