---
layout: "vault"
page_title: "Vault: vault_keymgmt_distribute_key resource"

description: |-
  Distributes keys from Vault to external KMS providers
---

# vault\_keymgmt\_distribute\_key

Distributes a key from Vault's Key Management secrets engine to an external Key Management Service provider (AWS KMS, Azure Key Vault, or GCP Cloud KMS). This resource manages the distribution of cryptographic keys to external KMS systems, allowing them to be used for encryption, decryption, signing, and verification operations in cloud environments.

~> **Important** All data provided in the resource configuration will be
written in cleartext to state and plan files generated by Terraform, and
will appear in the console output when Terraform runs. Protect these
artifacts accordingly. See
[the main provider documentation](../index.html)
for more details.

**Note** this feature is available only with Vault Enterprise.

## Example Usage

### Distribute to AWS KMS

```hcl
resource "vault_mount" "keymgmt" {
  path = "keymgmt"
  type = "keymgmt"
}

resource "vault_keymgmt_key" "encryption_key" {
  path = vault_mount.keymgmt.path
  name = "aws-encryption-key"
  type = "aes256-gcm96"
}

resource "vault_keymgmt_aws_kms" "aws" {
  path           = vault_mount.keymgmt.path
  name           = "aws-kms"
  key_collection = "us-west-2"
  access_key     = var.aws_access_key_id
  secret_key     = var.aws_secret_access_key
}

resource "vault_keymgmt_distribute_key" "aws_dist" {
  path       = vault_mount.keymgmt.path
  kms_name   = vault_keymgmt_aws_kms.aws.name
  key_name   = vault_keymgmt_key.encryption_key.name
  purpose    = ["encrypt", "decrypt"]
  protection = "hsm"
}
```

### Distribute to AWS KMS (Using Environment Variables)

```hcl
# When AWS credentials are configured via environment variables or IAM roles
# on the Vault server, you can omit access_key and secret_key
resource "vault_keymgmt_aws_kms" "aws" {
  path           = vault_mount.keymgmt.path
  name           = "aws-kms"
  key_collection = "us-west-2"
  # No credentials - Vault uses AWS SDK credential chain
}

resource "vault_keymgmt_distribute_key" "aws_dist" {
  path     = vault_mount.keymgmt.path
  kms_name = vault_keymgmt_aws_kms.aws.name
  key_name = vault_keymgmt_key.encryption_key.name
  purpose  = ["encrypt", "decrypt"]
}
```

### Distribute to Azure Key Vault

```hcl
resource "vault_keymgmt_key" "signing_key" {
  path = vault_mount.keymgmt.path
  name = "azure-signing-key"
  type = "rsa-2048"
}

resource "vault_keymgmt_azure_kms" "azure" {
  path           = vault_mount.keymgmt.path
  name           = "azure-kv"
  key_collection = "my-keyvault"
  tenant_id      = var.azure_tenant_id
  client_id      = var.azure_client_id
  client_secret  = var.azure_client_secret
}

resource "vault_keymgmt_distribute_key" "azure_dist" {
  path     = vault_mount.keymgmt.path
  kms_name = vault_keymgmt_azure_kms.azure.name
  key_name = vault_keymgmt_key.signing_key.name
  purpose  = ["sign", "verify"]
}
```

### Distribute to GCP Cloud KMS

```hcl
resource "vault_keymgmt_key" "gcp_key" {
  path = vault_mount.keymgmt.path
  name = "gcp-encryption-key"
  type = "aes256-gcm96"
}

resource "vault_keymgmt_gcp_kms" "gcp" {
  path           = vault_mount.keymgmt.path
  name           = "gcp-kms"
  key_collection = "projects/my-project/locations/us-central1/keyRings/my-keyring"
  credentials    = file("gcp-credentials.json")
}

resource "vault_keymgmt_distribute_key" "gcp_dist" {
  path       = vault_mount.keymgmt.path
  kms_name   = vault_keymgmt_gcp_kms.gcp.name
  key_name   = vault_keymgmt_key.gcp_key.name
  purpose    = ["encrypt", "decrypt"]
  protection = "software"
}
```

## Argument Reference

The following arguments are supported:

* `namespace` - (Optional) The namespace of the target resource.
  The value should not contain leading or trailing forward slashes.
  The `namespace` is always relative to the provider's configured
  [namespace](/docs/providers/vault/index.html#namespace).
  *Available only for Vault Enterprise*.

* `path` - (Required) Path where the Key Management secrets engine is mounted.

* `kms_name` - (Required) Name of the KMS provider to distribute the key to (configured via `vault_keymgmt_aws_kms`, `vault_keymgmt_azure_kms`, or `vault_keymgmt_gcp_kms`).

* `key_name` - (Required) Name of the key to distribute (created via `vault_keymgmt_key`).

* `purpose` - (Required) List of key purposes. Valid values depend on the key type and target KMS:
  - For symmetric keys (AES): `["encrypt", "decrypt"]`
  - For asymmetric keys (RSA, ECDSA): `["encrypt", "decrypt"]`, `["sign", "verify"]`, or combinations

* `protection` - (Optional) Protection level for the distributed key. Valid values:
  - `software` - Software-protected key (default)
  - `hsm` - Hardware Security Module protected key (if supported by the target KMS)

## Attributes Reference

In addition to the arguments above, the following attributes are exported:

* `id` - The unique identifier for the key distribution. Format: `{path}/kms/{kms_name}/key/{key_name}`

* `key_id` - The ID of the distributed key in the external KMS.

## Import

Key distributions can be imported using the format `{path}/kms/{kms_name}/key/{key_name}`, e.g.

```
$ terraform import vault_keymgmt_distribute_key.aws_dist keymgmt/kms/aws-kms/key/aws-encryption-key
```

## Key Purposes

### Encrypt/Decrypt

Used for symmetric and asymmetric encryption operations. The key can be used to encrypt data in the cloud provider's environment.

### Sign/Verify

Used for digital signature operations with asymmetric keys (RSA, ECDSA). The key can be used to sign data and verify signatures.

## Protection Levels

### Software Protection

Keys are protected by the cloud provider's software-based security mechanisms. This is the default and most cost-effective option.

### HSM Protection

Keys are stored and processed in Hardware Security Modules (HSMs). This provides:
- FIPS 140-2 Level 3 compliance (or higher)
- Tamper-resistant hardware
- Higher security guarantees
- Higher cost

**Note:** HSM protection availability depends on the target KMS provider and their service tier.

## Provider-Specific Considerations

### AWS KMS

- HSM protection is available through AWS CloudHSM
- Keys distributed to AWS KMS can be used with AWS services like S3, EBS, RDS, etc.
- AWS KMS enforces regional key storage

### Azure Key Vault

- HSM protection is available through Azure Dedicated HSM or Premium tier Key Vaults
- Keys can be used with Azure services like Storage, SQL Database, Disk Encryption, etc.
- Premium SKU is required for HSM-backed keys

### GCP Cloud KMS

- HSM protection is available through Cloud HSM
- Keys can be used with GCP services like Cloud Storage, Compute Engine, BigQuery, etc.
- Protection level must be specified when creating the key ring

## Key Distribution Lifecycle

1. Create a key in Vault using `vault_keymgmt_key`
2. Configure a KMS provider using `vault_keymgmt_aws_kms`, `vault_keymgmt_azure_kms`, or `vault_keymgmt_gcp_kms`
3. Distribute the key using `vault_keymgmt_distribute_key`
4. The key material is securely transferred to the external KMS
5. The key can now be used in the cloud provider's environment
6. When the Terraform resource is destroyed, the key is removed from the external KMS but remains in Vault
